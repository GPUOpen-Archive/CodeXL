CC = g++
OPTIMIZE = -O3 -DNDEBUG
DEBUG_CFLAGS = -g -O0 -D_DEBUG
ADDL_LINKFLAGS =
LINKFLAGS_EXE = $(ADDL_LINKFLAGS)
LINKFLAGS_SO = -shared -Wl,-z,defs $(ADDL_LINKFLAGS)
PLATFORM_CFLAG =
PLATFORM_LFLAG =
TARGET_SUFFIX =
ADDL_CFLAGS =
CFLAGS = $(OPTIMIZE) -std=c++11 -fPIC -Wall -Wno-unknown-pragmas -Wno-strict-aliasing -Wno-non-virtual-dtor -Wno-conversion-null -Wno-ignored-attributes -Werror -msse $(PLATFORM_CFLAG) $(ADDL_CFLAGS)
HSAFDN_CFLAGS =
PLATFORM_DIR = x64
HSA_PLATFORM_DIR = x86_64
AMD_LIB_SUFFIX =
HSA_PLATFORM_SUFFIX = 64
HSA_PLATFORM_SUFFIX_COMPILER_LIB = 64
MAKEFILENAME=makefile
CODEXL_OUTPUT_DIR=Output_x86_64
BASE_OBJDIR = obj
DEBUG_RELEASE=release
INTERNAL_PUBLIC =
OBJ_DIR = $(BASE_OBJDIR)/$(DEBUG_RELEASE)$(INTERNAL_PUBLIC)/$(PLATFORM_DIR)

# Build defines
BASE_DEFINES = -D_LINUX -DUSE_POINTER_SINGLETON
ADDL_DEFINES =
ADDITIONAL_COMPILER_DEFINES_FROM_BUILD_SCRIPT =
BUILD_DEFINES = -DGDT_PUBLIC -DGDT_BUILD_SUFFIX=\"\"
PLATFORM_DEFINES = -DGDT_PLATFORM_SUFFIX=\"\"
DEBUG_DEFINES = -DGDT_DEBUG_SUFFIX=\"\"
DEFINES = $(BASE_DEFINES) $(BUILD_DEFINES) $(PLATFORM_DEFINES) $(DEBUG_DEFINES) $(ADDL_DEFINES) $(ADDITIONAL_COMPILER_DEFINES_FROM_BUILD_SCRIPT)

# Directory definitions
BACKEND_DIR = $(DEPTH)/Backend
BACKEND_OUTPUT_DIR=$(BACKEND_DIR)/CodeXLGpuProfiler
BACKEND_COMMON_DIR = $(BACKEND_DIR)/Common
BACKEND_DEVICEINFO_DIR = $(BACKEND_DIR)/DeviceInfo
BACKEND_CLCOMMON_DIR = $(BACKEND_DIR)/CLCommon
BACKEND_CLPROFILEAGENT_DIR = $(BACKEND_DIR)/CLProfileAgent
BACKEND_CLTRACEAGENT_DIR = $(BACKEND_DIR)/CLTraceAgent
BACKEND_CLTHREADTRACEAGENT_DIR = $(BACKEND_DIR)/CLThreadTraceAgent
BACKEND_CLOCCUPANCYAGENT_DIR = $(BACKEND_DIR)/CLOccupancyAgent
BACKEND_SPROFILE_DIR = $(BACKEND_DIR)/sprofile
BACKEND_SANALYZE_DIR = $(BACKEND_DIR)/sanalyze
BACKEND_HSAFDNCOMMON_DIR = $(BACKEND_DIR)/HSAFdnCommon
BACKEND_HSAFDNTRACE_DIR = $(BACKEND_DIR)/HSAFdnTrace
BACKEND_HSAUTILS_DIR = $(BACKEND_DIR)/HSAUtils

CODEXL_FRAMEWORK_OUTPUT_DIR = $(DEPTH)/$(CODEXL_OUTPUT_DIR)/$(DEBUG_RELEASE)/bin

COMMON_DIR = $(DEPTH)/../../../Common
COMMON_SRC = $(COMMON_DIR)/Src
COMMON_LIB = $(COMMON_DIR)/Lib
COMMON_LIB_AMD = $(COMMON_DIR)/Lib/AMD
COMMON_LIB_EXT = $(COMMON_DIR)/Lib/Ext
GPU_PERF_API_DIR = $(COMMON_LIB_AMD)/GPUPerfAPI/2_21/Include
GPU_THREAD_TRACE_DIR = $(COMMON_LIB_AMD)/GPUThreadTrace/1_1
GPU_THREAD_TRACE_API_DIR = $(GPU_THREAD_TRACE_DIR)/Include
ATI_STREAM_SDK_DIR = $(COMMON_LIB_AMD)/APPSDK/3-0
APPSDK_DIR = $(ATI_STREAM_SDK_DIR)
CAL_DIR = $(COMMON_LIB_AMD)/CAL/8.95
ACL_DIR = $(COMMON_LIB_AMD)/ACL/TOT
HSA_DIR = /opt/rocm/hsa
HSA_LIB_DIR = $(HSA_DIR)/lib/$(HSA_PLATFORM_DIR)
BOOST_DIR = $(COMMON_LIB_EXT)/Boost/boost_1_59_0
BOOST_LIB_DIR = $(BOOST_DIR)/lib/RHEL6/$(HSA_PLATFORM_DIR)
DEVICEINFO_DIR = $(COMMON_SRC)/DeviceInfo
DYNAMICLIBRARYMODULE_DIR = $(COMMON_SRC)/DynamicLibraryModule
GPUPERFAPIUTILS_DIR = $(COMMON_SRC)/GPUPerfAPIUtils
GPUTHREADTRACEUTILS_DIR = $(COMMON_SRC)/GPUThreadTraceUtils
TSINGLETON_DIR = $(COMMON_SRC)/TSingleton
AMDTMUTEX_DIR = $(COMMON_SRC)/AMDTMutex
ACLMODULEMANAGER_DIR = $(COMMON_SRC)/ACLModuleManager
UTF8CPP_DIR = $(COMMON_LIB_EXT)/utf8cpp/source
GTEST_DIR = $(COMMON_LIB_EXT)/GoogleTest/1-7
GMOCK_DIR = $(COMMON_LIB_EXT)/GoogleMock/gmock-1.7.0
ADL_DIR = $(COMMON_LIB_AMD)/ADL
ADLUTIL_DIR = $(COMMON_SRC)/ADLUtil
HSATESTCOMMON_DIR = $(COMMON_SRC)/HSATestCommon
COMMON_PROJ_DIR = $(COMMON_DIR)/Src
CELF_DIR = $(COMMON_SRC)/CElf
HSAUTILS_DIR = $(COMMON_SRC)/HSAUtils

GPU_PROFILER_LIB_PREFIX=CXLGpuProfiler

# Lib paths
COMMON_LIB_PATHS = -L$(CODEXL_FRAMEWORK_OUTPUT_DIR) -L$(BACKEND_COMMON_DIR) -L$(BACKEND_DEVICEINFO_DIR)
AMD_LIB_PATH = Bin/Linx64/
COMMON_DEVICE_INFO_LIB = -Wl,--whole-archive -l$(GPU_PROFILER_LIB_PREFIX)DeviceInfo$(TARGET_SUFFIX) -Wl,--no-whole-archive
COMMON_LIBS = -l$(GPU_PROFILER_LIB_PREFIX)Common$(TARGET_SUFFIX) $(COMMON_DEVICE_INFO_LIB)
CLCOMMON_LIBS = -L$(BACKEND_CLCOMMON_DIR) -l$(GPU_PROFILER_LIB_PREFIX)CLCommon$(TARGET_SUFFIX)
HSAFDNCOMMON_LIBS = -L$(BACKEND_HSAFDNCOMMON_DIR) -l$(GPU_PROFILER_LIB_PREFIX)HSACommon$(TARGET_SUFFIX)
HSAUTILS_LIBS = -L$(BACKEND_HSAUTILS_DIR) -l$(GPU_PROFILER_LIB_PREFIX)HSAUtils$(TARGET_SUFFIX)
FRAMEWORK_LIBS = -lCXLOSWrappers -lCXLBaseTools
STANDARD_LIBS = -lrt -ldl -lpthread
GTEST_LIBS = ./$(GTEST_DIR)/lib/$(PLATFORM_DIR)/libgtest.a
GMOCK_LIBS = ./$(GMOCK_DIR)/lib/$(PLATFORM_DIR)/libgmock.a
HSA_LIBS = -L$(HSA_LIB_DIR) -lhsaild -l:libhsa-runtime$(HSA_PLATFORM_SUFFIX).so.1 -l:libhsa-runtime-tools$(HSA_PLATFORM_SUFFIX).so.1
GPU_THREAD_TRACE_LIB_DIR = -L$(GPU_THREAD_TRACE_DIR)/$(AMD_LIB_PATH)
GPU_THREAD_TRACE_LIB = -lGPUThreadTrace$(AMD_LIB_SUFFIX)
PERFORMANCE_EXPERIMENT_FILE_LIB = -lPerformanceExperimentFile$(AMD_LIB_SUFFIX)

# Build target overrides
X86_OVERRIDES = "PLATFORM_CFLAG = -m32 -msse2" "PLATFORM_LFLAG = -m32" "PLATFORM_DEFINES = -DX86 -DGDT_PLATFORM_SUFFIX=\\\"32\\\"" "CODEXL_OUTPUT_DIR = Output_x86" "PLATFORM_DIR = x86" "HSA_PLATFORM_DIR = x86" "HSA_PLATFORM_SUFFIX =" "HSA_PLATFORM_SUFFIX_COMPILER_LIB = 32"
INTERNAL_OVERRIDES = "BUILD_DEFINES = -DGDT_INTERNAL -DGDT_BUILD_SUFFIX=\\\"-Internal\\\"" "INTERNAL_PUBLIC = _Internal"
DEBUG_OVERRIDES = "OPTIMIZE = $(DEBUG_CFLAGS)" "DEBUG_RELEASE = debug" "DEBUG_DEFINES = -DGDT_DEBUG_SUFFIX=\\\"-d\\\""

BUILD_X86_OVERRIDES = "TARGET_SUFFIX = 32" "AMD_LIB_PATH = Bin/Linx86/" "AMD_LIB_SUFFIX = 32" $(X86_OVERRIDES)
BUILD_INTERNAL_OVERRIDES = "TARGET_SUFFIX = -Internal" "AMD_LIB_PATH = Bin-Internal/Linx64/" "AMD_LIB_SUFFIX = -Internal" $(INTERNAL_OVERRIDES)
BUILD_INTERNAL_X86_OVERRIDES = "TARGET_SUFFIX = 32-Internal" "AMD_LIB_PATH = Bin-Internal/Linx86/" "AMD_LIB_SUFFIX = 32-Internal" $(X86_OVERRIDES) $(INTERNAL_OVERRIDES)
BUILD_DEBUG_OVERRIDES = "TARGET_SUFFIX = -d" $(DEBUG_OVERRIDES)
BUILD_DEBUG_X86_OVERRIDES = "TARGET_SUFFIX = 32-d" "AMD_LIB_PATH = Bin/Linx86/" "AMD_LIB_SUFFIX = 32" $(DEBUG_OVERRIDES) $(X86_OVERRIDES)
BUILD_DEBUG_INTERNAL_OVERRIDES = "TARGET_SUFFIX = -d-Internal" "AMD_LIB_PATH = Bin-Internal/Linx64/" "AMD_LIB_SUFFIX = -Internal" $(INTERNAL_OVERRIDES) $(DEBUG_OVERRIDES)
BUILD_DEBUG_INTERNAL_X86_OVERRIDES = "TARGET_SUFFIX = 32-d-Internal" "AMD_LIB_PATH = Bin-Internal/Linx86/" "AMD_LIB_SUFFIX = 32-Internal" $(X86_OVERRIDES) $(INTERNAL_OVERRIDES) $(DEBUG_OVERRIDES)

